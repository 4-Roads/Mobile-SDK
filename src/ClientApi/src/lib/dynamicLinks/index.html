<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Links</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta "mobile-web-app-status-bar-style" content="black" />
    <meta name="viewport" content="initial-scale = 1.0, user-scalable = no">

    <link rel="stylesheet" type="text/css" href="../../normalize.css" />
    <link rel="stylesheet" type="text/css" href="screen.css" />

    <style>
    #wrapper {
        width: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        }
    #container {
        overflow-y: auto;
        position: relative;
        height: 100%;
        -webkit-overflow-scrolling: touch;
        }
    .tray {
        visibility: hidden;
        }
        .tray a {
            background-color: #CCC;
            border-radius: 3px;
            color: #444;
            padding: 10px;
            text-decoration: none;
            margin: 0 3px 3px 0;
            }
            .tray a.selected {
                background-color: #444;
                color: #CCC;
                }
    #content .item-a a { color: red; }
    #content .item-b a { color: green; }
    #content .item-c a { color: blue; }
    #content .item-d a { color: orange; }
    #content .item-e a { color: yellow; }
    </style>
<body>

    <div id="viewport" class="">
        <div id="debug" class="fixed"></div>
        <div id="gutter-wrapper">
            <div id="gutter" style="width: 100%;">
                <div id="gutter-content-wrapper">
                    <div id="gutter-content">
                        gutter content
                    </div>
                </div>
            </div>
        </div>
        <div id="content-wrapper">
            <div id="header" class="fixed">
                <span>Headers</span>
            </div>
            <div id="content">
                <div id="refresh-indicator">
                    Pull to Refresh
                </div>
                <div id="refreshable-content">
                    <div class="slideable">
                        <h4>Shell Test</h4>
                        <div class="dynamicLinks"
                            data-minlinks="10"
                            data-maxlinks="50">
                            <ul>
                                <li><a href="#" class="link">Link 1</a></li>
                                <li><a href="#" class="link">Link 2b</a></li>
                                <li><a href="#" class="link selected" data-selected>Link 3bc</a></li>
                                <li><a href="#" class="link">Link 4</a></li>
                                <li><a href="#" class="link">Link 5bcd</a></li>
                                <li><a href="#" class="link">Link 6bcde</a></li>
                                <li><a href="#" class="link" data-more>More</a></li>
                                <li><a href="#" data-cancel>Cancel</a></li>
                            <ul>
                        </div>
                        <div class="dynamicLinks"
                            data-minlinks="10"
                            data-maxlinks="50">
                            <ul>
                                <li><a href="#" class="link selected" data-selected>Link 1</a></li>
                                <li><a href="#" class="link">Link 2b</a></li>
                                <li><a href="#" class="link">Link 3bc</a></li>
                                <li><a href="#" class="link">Link 4</a></li>
                                <li><a href="#" class="link">Link 5bcd</a></li>
                                <li><a href="#" class="link">Link 6bcde</a></li>
                                <li><a href="#" class="link" data-more>More</a></li>
                                <li><a href="#" data-cancel>Cancel</a></li>
                            <ul>
                        </div>
                        <div class="dynamicLinks"
                            data-minlinks="10"
                            data-maxlinks="50">
                            <ul>
                                <li><a href="#" class="link">Link 1</a></li>
                                <li><a href="#" class="link">Link 2b</a></li>
                                <li><a href="#" class="link">Link 3bc</a></li>
                                <li><a href="#" class="link">Link 4</a></li>
                                <li><a href="#" class="link">Link 5bcd</a></li>
                                <li><a href="#" class="link selected" data-selected>Link 6bcde</a></li>
                                <li><a href="#" class="link" data-more>More</a></li>
                                <li><a href="#" data-cancel>Cancel</a></li>
                            <ul>
                        </div>
                        <div class="dynamicLinks"
                            data-minlinks="1"
                            data-maxlinks="2">
                            <ul>
                                <li><a href="#" class="link">Link 1</a></li>
                                <li><a href="#" class="link" id="link2">Link 2b</a></li>
                                <li><a href="#" class="link">Link 3bc</a></li>
                                <li><a href="#">Link 4</a></li>
                                <li><a href="#" class="link">Link 5bcd</a></li>
                                <li><a href="#" class="link">Link 6bcde</a></li>
                                <li><a href="#" class="link" data-more>More</a></li>
                                <li><a href="#" class="link" data-cancel>Cancel</a></li>
                            <ul>
                        </div>
                        <div class="dynamicLinks">
                            <ul>
                                <li class="item-a"><a href="#" class="link">Link 1</a></li>
                                <li class="item-b"><a href="#" class="removable link" id="link2">Link 2b</a></li>
                                <li class="item-c"><a href="#" class="removable link">Link 3bc</a></li>
                                <li class="item-d"><a href="#" class="link">Link 4</a></li>
                                <li class="item-e"><a href="#" class="link">Link 5bcd</a></li>
                                <li><a href="#" class="link">Link 6bcde</a></li>
                                <li><a href="#" class="link" data-more>More</a></li>
                                <li><a href="#" class="link" data-cancel>Cancel</a></li>
                            <ul>
                        </div>
                        <p>Fusce lacinia odio et felis congue eleifend. Phasellus at est orci, eu dapibus massa. Nam id magna porta risus</p>
                        <p>facilisis pretium non non augue. Integer sed felis non mi blandit posuere. Pellentesque habitant morbi tristique senectus et netus</p>
                        <p>et malesuada fames ac turpis egestas. Maecenas sit amet elit eget leo interdum congue sit amet et ipsum. Curabitur fringilla, tortor </p>
                        <p>ut bibendum luctus, libero ligula adipiscing libero, quis eleifend mi justo ut nulla. Etiam in massa nisl, at venenatis est. Donec </p>
                        <p>scelerisque, odio sit amet gravida sollicitudin, orci dui dapibus lectus, ac tristique sapien orci a arcu. Duis sed imperdiet lectus. </p>
                        <p>Nam elementum adipiscing dui, nec placerat dolor suscipit vel. Aenean faucibus vestibulum magna sit amet fermentum.</p>
                        <p>ut bibendum luctus, libero ligula adipiscing libero, quis eleifend mi justo ut nulla. Etiam in massa nisl, at venenatis est. Donec </p>
                        <p>scelerisque, odio sit amet gravida sollicitudin, orci dui dapibus lectus, ac tristique sapien orci a arcu. Duis sed imperdiet lectus. </p>
                        <p>Nam elementum adipiscing dui, nec placerat dolor suscipit vel. Aenean faucibus vestibulum magna sit amet fermentum.</p>
                        <p>Nam elementum adipiscing dui, nec placerat dolor suscipit vel. Aenean faucibus vestibulum magna sit amet fermentum.</p>
                        <p>ut bibendum luctus, libero ligula adipiscing libero, quis eleifend mi justo ut nulla. Etiam in massa nisl, at venenatis est. Donec </p>
                        <p>scelerisque, odio sit amet gravida sollicitudin, orci dui dapibus lectus, ac tristique sapien orci a arcu. Duis sed imperdiet lectus. </p>
                        <p>Nam elementum adipiscing dui, nec placerat dolor suscipit vel. Aenean faucibus vestibulum magna sit amet fermentum.</p>
                        <p>Nam elementum adipiscing dui, nec placerat dolor suscipit vel. Aenean faucibus vestibulum magna sit amet fermentum.</p>
                        <p>ut bibendum luctus, libero ligula adipiscing libero, quis eleifend mi justo ut nulla. Etiam in massa nisl, at venenatis est. Donec </p>
                        <p>scelerisque, odio sit amet gravida sollicitudin, orci dui dapibus lectus, ac tristique sapien orci a arcu. Duis sed imperdiet lectus. </p>
                        <p>Nam elementum adipiscing dui, nec placerat dolor suscipit vel. Aenean faucibus vestibulum magna sit amet fermentum.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../jquery.min.js"></script>
    <script src="../../scroll.js"></script>
    <script src="../../define.js"></script>
    <script src="../../testlog.js"></script>
    <script src="../../telligent.evolution.js"></script>
    <script src="../scrollfix/scrollfix.js"></script>
    <script src="../refresh/refresh.js"></script>
    <script src="../util/util.js"></script>
    <script src="../sheet/sheet.js"></script>
    <script src="../actionSheet/actionSheet.js"></script>
    <script src="../shell/shell.js"></script>
    <script src="../messaging/messaging.js"></script>
    <script src="dynamicLinks.js"></script>

    <script type="text/javascript">
    require(['shell', 'dynamicLinks', 'messaging'], function(Shell, DynamicLinks, messaging, $, global, undef) {

        // set up a shell just to make sure the tray works inside a shell too
        var refreshIndicator = $('#refresh-indicator'),
            header = $('#header'),
            refreshableContent = $('#refreshable-content');

        var orientationChangeTimeout;

        var shell = new Shell({
            header: header,
            viewport: '#viewport',
            gutter: '#gutter',
            content: '#content',
            contentWrapper: '#content-wrapper',
            gutterWrapper: '#gutter-wrapper',
            gutterContent: '#gutter-content',
            refreshIndicator: refreshIndicator,
            refreshableContent: refreshableContent,
            debugContainer: '#debug',
            onRefreshRevealing: function(percent) {
                if(percent >= 1) {
                    refreshIndicator.html('Release to refresh...');
                } else {
                    refreshIndicator.html('Pull down to refresh... ' + Math.round(100 * percent) + '%');
                }
            },
            onRefreshing: function(complete) {
                refreshIndicator.html('Refreshing...');
                setTimeout(function(){
                    complete();
                    refreshableContent.find('h4:first').get(0).innerHTML = 'Refreshed! ' + (new Date().getTime());
                }, 1200);
            }
        });

        header.on('tap', function(){
            if(shell.navigationVisible()) {
                shell.navigationVisible(false);
            } else {
                shell.navigationVisible(true);
            }
        });

        // add behavior to a link to verify it is retained
        $('#link2').on('tap', function(){
            console.log('clicked link 2 at ' + new Date());
        })

        $('div.dynamicLinks').each(function(){
            var elm = $(this),
                //linkElements = elm.find('li > a').detach(),
                listItems = elm.find('li'),
                parsedMaxLinks = elm.data('maxlinks'),
                parsedMinLinks = elm.data('minlinks');

            var options = {
                parent: elm,
                links: []
            };
            if(parsedMaxLinks)
                options.maxLinks = parseInt(parsedMaxLinks, 10);
            if(parsedMinLinks)
                options.minLinks = parseInt(parsedMinLinks, 10);

            // add test links for modifying the dynamic links
            var addLink = $('<a href="#">Add</a>'),
                insertLink = $('<a href="#">Insert</a>'),
                removeLink = $('<a href="#">Delete</a>'),
                modificationLinks = $('<div></div>');
            modificationLinks.append(addLink).append(insertLink).append(removeLink);
            elm.after(modificationLinks);

            for(var i = 0; i < listItems.length; i++) {
                var listItem = $(listItems[i]),
                    linkElement = listItem.find('a').detach(),
                    selected = linkElement.is('[data-selected]');

                if(linkElement.is('[data-more]')) {
                    options.moreLink = {
                        element: linkElement,
                        selected: selected
                    };
                } else if(linkElement.is('[data-cancel]')) {
                    options.cancelLink = {
                        element: linkElement,
                        selected: selected
                    };
                } else {
                    options.links.push({
                        element: linkElement,
                        selected: selected,
                        className: listItem.get(0).className
                    });
                }
            }
            options.onShowMore = function(links, cancelLink) {
                console.log('showing more');
                console.log(links);
                console.log(cancelLink);
            }
            elm.empty();

            var dynamicLinks = new DynamicLinks(options);
            dynamicLinks.render();

            addLink.on('tap', function(e){
                e.preventDefault();
                e.stopPropagation();

                // add a new link to the dynamic links
                var newLink = $('<a class="link" href="#">LX</a>');
                newLink.on('tap', function(){
                    console.log('added link tap');
                });

                dynamicLinks.addLink({
                    className: 'liClassName',
                    element: newLink,
                    selected: false
                }, null);
            });

            insertLink.on('tap', function(e){
                e.preventDefault();
                e.stopPropagation();

                // add a new link to the dynamic links
                var newLink = $('<a class="link" href="#">LY</a>');
                newLink.on('tap', function(){
                    console.log('inserted link tap');
                });

                dynamicLinks.addLink({
                    className: 'liClassName',
                    element: newLink,
                    selected: false
                }, 1);
            });

            removeLink.on('tap', function(e){
                dynamicLinks.removeLink('.removable');
            });

            // re-render on orientation change
            $(window).bind('orientationchange', function(){
                clearTimeout(orientationChangeTimeout);
                orientationChangeTimeout = setTimeout(function(){
                    dynamicLinks.render();
                }, 500);
            });

        });

    }, jQuery, window);
    </script>


</body>
</html>
